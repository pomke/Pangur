{% import "forms.html" as m %}

<!--
example:
    { % import "comment_macros.html" as comments with context % }
    <head>
        <script src="/js/jquery-1.4.2.min.js" type="text/javascript"></script>
        <script src="/js/pomke.js"></script>
        { { comments.resources() } }
    </head>
    <body>
        { { comments.addCommentForm() } }
        { { comments.listWithAvatarAlt([]) } }
    </body>
-->


{% macro resources() %}

<script src='/js/comments.js'></script>
<link rel="stylesheet" type="text/css" href="/css/comments.css" />

<script type="text/javascript" src="/markitup/jquery.markitup.js"></script>
<script type="text/javascript" src="/markitup/sets/default/set.js"></script>
<link rel="stylesheet" type="text/css" href="/markitup/skins/markitup/style.css" />
<link rel="stylesheet" type="text/css" href="/markitup/sets/default/style.css" />

{% endmacro %}


{% macro addCommentForm() %}

   <form method='post'>
       {% set f = request.forms.load('AddCommentForm') %}
       {{ f.text }}
       {{ m.submit(f, 'Add a Comment') }}
   </form>

   <div id="replyForm">
       <div class='emoticon'><span class='icon'></span><span>Select a mood</span></div>
       <div class='emoticons hidden'>
           <ul>
               <li>
                   <ul>
                       <li class="happy" title="happy"></li>
                       <li class="sad" title="sad"></li>
                       <li class="grumpy" title="grumpy"></li>
                       <li class="cool" title="cool"></li>
                   </ul>
               </li>
               <li>
                   <ul>
                       <li class="surprised" title="surprised"></li>
                       <li class="love" title="love"></li>
                       <li class="embarassed" title="embarassed"></li>
                       <li class="tear" title="tear"></li>
                   </ul>
               </li>
               <li>
                   <ul>
                       <li class="awed" title="awed"></li>
                       <li class="boggled" title="boggled"></li>
                       <li class="artistic" title="artistic"></li>
                       <li class="thumbs" title="thumbs up"></li>
                   </ul>
               </li>
           </ul>
       </div>
       <textarea></textarea>
   </div>

{% endmacro %}


{% macro listWithAvatarAlt(sortedComments) %}

<script type="text/javascript">
    $(function(){comments.CommentMenu();});
</script>

<div id='commentMenu' class='hidden'></div>

<ul class="comments">
    {% for c in sortedComments %}
    {% if c.deleted %}

    <li style="margin-left:{{c.indent}}em;" id='c{{c.id}}' class="{{ loop.cycle('comAvRight', 'comAvLeft') }}">
        Comment deleted by <a href="/artist/{{c.user.username}}">{{c.user.prefs.name}}</a>
    </li>

    {% else %}

    <li style="margin-left:{{c.indent}}em;" id='c{{c.id}}' class="{{ loop.cycle('comAvRight', 'comAvLeft') }}">
    <div class='avatar' style='background-image:url({{c.user.prefs.profileImagePath}});'></div>
    <div class='leader'>About {{c.timesince}} ago <a href="/artist/{{c.user.username}}">{{c.user.prefs.name}}</a> said:
    {% if request.session.authenticated %}
    <div class='commentActions' id='{{c.id}}'>
            <img src="/images/expand-down.png"/> Actions
        </div>
    {% endif %}
    </div>
    <div class='text'>{{ c.text }}</div>
    <div class='clear'></div>

    {% endif %}
    </li>

    {% endfor %}
</ul>

{% endmacro %}
